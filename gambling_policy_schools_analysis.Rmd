---
title: "gambling_policy_schools_analysis"
author: "Victoria Ifatusin"
date: "11/2/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Sports Betting & Gambling Policies on College Campuses

```{r}
# Turn off scientific notation
options(scipen=999)
# Loading tidyverse and other packages.
library(tidyverse)
library(janitor)
library(ggplot2)
library(dplyr)
```

# Our Data

Student reporters in the Povich Center reached out to all 231 Division I public universities to ask for campus policies regarding gambling. The information received was put into an Google Forms sheet. 

```{r}
# Overall cleaning of policy tracker

## Loading the updated tracker as of Dec. 4, 2022, and cleaning it by renaming the column names.  
uni_policies_updated <- read_csv("policy_tracker_12042022.csv") %>% 
  clean_names() %>% 
  rename(state_abb = state) %>% 
  rename(school_policy_exist =
           does_the_school_have_a_policy_on_sports_gambling_betting_that_extends_beyond_ncaa_policy) %>% 
  rename(allowed = is_sports_gambling_betting_allowed) %>% 
  rename(state_law = does_the_response_cite_state_law) %>% 
  rename(covered = who_is_covered) %>% 
  rename(campus_allowed = is_sports_gambling_allowed_on_or_off_campus) %>%
  rename(detail = detail_if_there_isnt_any_detail_put_n_a) %>% 
  rename(interesting = rate_the_policys_interestingness_on_a_scale_from_1_5) %>% 
  rename(specifics = give_specific_key_words_or_phrases) %>% 
  rename(advert_policy_exist =
           does_the_school_have_a_policy_on_the_advertising_or_promotion_of_gambling_or_gaming_products_and_services) %>% 
  rename(detail_advert = briefly_describe_the_advertising_policy_if_theres_no_policy_or_its_unclear_please_put_n_a) %>% 
  rename(school_abb = school)

## Checking to see if which schools were submitted in twice or more. 
uni_policies_updated %>% 
  group_by(school_uid) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))
### Three schools - UCLA (110662), UCSB(110705) and Northern Illinois(147703) were submitted twice. 

## Removing the older submission. Original is in Google Sheets. 
uni_policies_updated <- uni_policies_updated [-c(3,66,81),]


## Adding in new columns 
### Full state names 
us_states <- data.frame(state.name, state.abb) %>% 
  rename(state = state.name)

uni_policies_updated <- uni_policies_updated %>% 
  inner_join(us_states, by=c("state_abb" = "state.abb"))


### The legality of sports betting in the states. 
uni_policies_updated <- uni_policies_updated %>% 
  mutate(legal_illegal = case_when(
    state == 'Alabama' | state == 'Alaska' | state == 'California' | state == 'Florida' |
    state == 'Georgia' | state == 'Hawaii' | state == 'Idaho' | state == 'Kentucky' | 
    state == 'Minnesota' | state == 'Missouri' | state == 'Oklahoma' | state == 'South Carolina' |
    state == 'Texas' | state == 'Utah' | state == 'Vermont' ~ "illegal",
    state == 'Arizona' | state == 'Arkansas' | state == 'Colorado' | state == 'Connecticut' |
    state == 'Delaware' | state == 'Illinois' | state == 'Indiana' | state == 'Iowa' | 
    state == 'Kansas' | state == 'Louisiana' | state == 'Maine' | state == 'Maryland' | 
    state == 'Massachusetts' | state == 'Michigan' | state == 'Mississippi' | state == 'Montana' |
    state == 'Nebraska' | state == 'Nevada' | state == 'New Hampshire' | state == 'New Jersey' | 
    state == 'New Mexico' | state == 'New York' | state == 'North Carolina' | state == 'North Dakota' |
    state == 'Ohio' | state == 'Oregon' | state == 'Pennsylvania' | state == 'Rhode Island' | 
    state == 'South Dakota' | state == 'Tennessee' | state == 'Virginia' | state == 'Washington' |
    state == 'West Virginia' | state == 'Wisconsin' | state == 'Wyoming' ~ "legal"))

## Checking again to see if any other schools have been filled in twice or more. 
uni_policies_updated %>% 
  group_by(school_uid) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))
### 97 schools.


# Overall cleaning of list of schools
all_schools <- read_csv("list_of_school_states.csv") %>% 
  clean_names()

## Checking to see if there are only 50 states
all_schools %>% 
  group_by(state) %>% 
  summarise(count = n()) %>% 
  arrange(state)

### Las Vegas and Tennesse are states. Editing these.
all_schools <- all_schools %>% 
  mutate(state = case_when(
    state == "Las Vegas" ~ "Nevada",
    state ==  "Tennesse" ~ "Tennessee",
    TRUE ~ state
  ))

## Checking again
all_schools %>% 
  group_by(state) %>% 
  summarise(count = n()) %>% 
  arrange(state)
### 48 states. 

## Adding in new column: legality
all_schools <- all_schools %>% 
  mutate(legal_illegal = case_when(
    state == 'Alabama' | state == 'Alaska' | state == 'California' | state == 'Florida' |
    state == 'Georgia' | state == 'Hawaii' | state == 'Idaho' | state == 'Kentucky' | 
    state == 'Minnesota' | state == 'Missouri' | state == 'Oklahoma' | state == 'South Carolina' |
    state == 'Texas' | state == 'Utah' | state == 'Vermont' ~ "illegal",
    state == 'Arizona' | state == 'Arkansas' | state == 'Colorado' | state == 'Connecticut' |
    state == 'Delaware' | state == 'Illinois' | state == 'Indiana' | state == 'Iowa' | 
    state == 'Kansas' | state == 'Louisiana' | state == 'Maine' | state == 'Maryland' | 
    state == 'Massachusetts' | state == 'Michigan' | state == 'Mississippi' | state == 'Montana' |
    state == 'Nebraska' | state == 'Nevada' | state == 'New Hampshire' | state == 'New Jersey' | 
    state == 'New Mexico' | state == 'New York' | state == 'North Carolina' | state == 'North Dakota' |
    state == 'Ohio' | state == 'Oregon' | state == 'Pennsylvania' | state == 'Rhode Island' | 
    state == 'South Dakota' | state == 'Tennessee' | state == 'Virginia' | state == 'Washington' |
    state == 'West Virginia' | state == 'Wisconsin' | state == 'Wyoming' ~ "legal"))
```

# Findings From Our Data
In total, we've reached out to 145 schools (63% out of 231 schools) that are in states where sports betting is legal. 64 of those schools (44%) responded back to us. 42 schools mention sports betting (29%).

As of Nov. 30, 2022, we have yet to hear from schools in the following legal states: Arkansas, Delaware, Maine, Massachusetts, Michigan, Montana, Nevada, New Hampshire, New Jersey, Pennsylvania, Rhode Island. 

```{r}
# What is the total number of schools we sent request to in states where betting is legal?
all_schools %>% 
  filter(legal_illegal == "legal") %>% 
  group_by(school) %>% 
  summarise(count = n()) %>% 
  arrange(school)

## Percentage of that:
total_legal_schools_pct = (145/231)*100         # 62.77% 

### We reached out to 145 schools that are in states where sports betting and gambling is legal. (In all, we reached out to 231 schools, 86 of which in are illegal states.) 


# What is the number of schools in legal states that responded to our request for policies/code of conduct? 
uni_policies_updated %>% 
  filter(legal_illegal == "legal") %>% 
  group_by(school_abb, state) %>% 
  summarise(count = n()) %>% 
  arrange(school_abb)

## Percentage for that:
legal_responded_legal_schools = (64/145)*100    #44.13% 

### Of the schools we reached out to that are in states where sports betting is legal, 44.1% of them (64 schools) responded to our request for policies regarding sports betting and gambling on college campuses.  


# What is the number of schools in legal states that have a policy? 
uni_policies_updated %>% 
  filter(legal_illegal == "legal") %>% 
  group_by(school_policy_exist) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))

### Of those schools, 33 of them have a policy on sports gambling. 

## Percentage for that:
policy_legal_schools = (33/145)*100                   #22.75% 
policy_legal_responded_schools = (33/64)*100           #51.56%


# How many of those schools allow sports gambling by policy?
legal_responded <- uni_policies_updated %>% 
  filter(legal_illegal == "legal" & school_policy_exist == "Yes" & allowed == "Yes")

write.csv(legal_responded, "legal_responded.csv")

### Seven of those 33 schools (21.2%) permit sports betting by policy. 

## Percentage for that:
allowed_responded_legal_schools = (7/64)*100                   #10.93% 
allowed_policy_exist_legal_schools = (7/33)*100                #21.21% 


# What about the schools that have a policy but don't allow it?
uni_policies_updated %>% 
  filter(legal_illegal == "legal" & school_policy_exist == "Yes" & allowed == "No")

## Percentage for that:
unallowed_policy_exist_legal_schools = (24/33)*100             #72.72% 
### Of the schools located in states that permit gambling, responded to our requests and have a policy on sports gambling, 73% ban sports gambling by policy; not all of those apply to all students.

unallowed_responded_legal_schools = (24/64)*100                #37.5% 
### Of the schools located in states that permit gambling and responded to our requests, 37.5% percent ban sports gambling, although some of their bans do not cover all students. That percentage may not describe all schools in states where gambling is legal, since dozens of schools did not respond to our requests. (Schools that have enough of an interest in sports betting to enact a policy are probably more likely to respond to a request for information about it.)

unallowed_legal_schools = (24/145)*100                         #16.55%  
### Of the schools located in states that permit gambling that we contacted, 16.5% have policies banning sports gambling, although nearly half of the schools did not respond to our requests.
```

# US Dept of Ed's Data

We decided to join our policy data to the student debt data provided by the US Dept of Ed's database -- College Scoreboard. We wanted to see if there's a correlation between the student loan debt at each school and the policy of the school by merging the two datasets together. 

The debt columns we used from the College Scoreboard data are: 
**Principal:** DEBT_MDN (The median original amount of the loan principal upon entering repayment)

**Graduation Status:** GRAD_DEBT_MDN (The median debt for students who have completed), WDRAW_DEBT_MDN (The median debt for students who have not completed)

**Family Income/Economic Class:** LO_INC_DEBT_MDN (The median debt for students with family income between $0-$30,000), MD_INC_DEBT_MDN (The median debt for students with family income between $30,001-$75,000), HI_INC_DEBT_MDN (The median debt for students with family income $75,001+)

**Dependency:** DEP_DEBT_MDN (The median debt for dependent students), IND_DEBT_MDN (The median debt for independent students)

**Financial Aid:** PELL_DEBT_MDN (The median debt for Pell students), NOPELL_DEBT_MDN (The median debt for no-Pell students)

**Gender:** FEMALE_DEBT_MDN (The median debt for female students), MALE_DEBT_MDN (The median debt for male students)

**Generation:** FIRSTGEN_DEBT_MDN (The median debt for first-generation students), NOTFIRSTGEN_DEBT_MDN (The median debt for not-first-generation students)

**Paying it Back:** GRAD_DEBT_MDN10YR (Median loan debt of completers in monthly payments [10-year amortization plan])

Something to note is that the median debt amount was between $20,000 and $24,999 in 2021. Safe to say that the median of that is $22,499.50 ~ $22,500. 

```{r}
# Loading in the data from College Scoreboard
college_data <- read_csv("recent_cohort_institution.csv") 

# Selecting specific columns from our data to later join with debt data. 
uni_w_debt <- uni_policies_updated %>%
  select(school_uid, school_abb, state, state_abb, legal_illegal, school_policy_exist, allowed, covered, campus_allowed)

# Selecting the debt columns from the new database
debt_responded_schools <- college_data %>% 
  select(UNITID, INSTNM, DEBT_MDN, GRAD_DEBT_MDN, WDRAW_DEBT_MDN, LO_INC_DEBT_MDN, MD_INC_DEBT_MDN, 
         HI_INC_DEBT_MDN, DEP_DEBT_MDN, IND_DEBT_MDN, PELL_DEBT_MDN, NOPELL_DEBT_MDN, FEMALE_DEBT_MDN,
         MALE_DEBT_MDN, FIRSTGEN_DEBT_MDN, NOTFIRSTGEN_DEBT_MDN, GRAD_DEBT_MDN10YR) 

# Joining the two datasets together and cleaning the column names. Also taking out a column I don't need right now nor understand: GRAD_DEBT_MDN10YR. 
uni_w_debt <- uni_w_debt %>% 
  inner_join(debt_responded_schools, by=c('school_uid'='UNITID')) %>%
  clean_names() %>% 
  select(school_uid, instnm, school_abb, state, state_abb, legal_illegal, school_policy_exist, allowed, covered, campus_allowed, debt_mdn, grad_debt_mdn, wdraw_debt_mdn, lo_inc_debt_mdn, md_inc_debt_mdn, hi_inc_debt_mdn, dep_debt_mdn, ind_debt_mdn, pell_debt_mdn, nopell_debt_mdn, female_debt_mdn, male_debt_mdn, firstgen_debt_mdn, notfirstgen_debt_mdn) %>% 
  rename(school = instnm)

# Checking to see the exact number of schools
uni_w_debt %>% 
  group_by(school) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))
#97 schools.

# Making the columns non-numeric debt columns, numeric
uni_w_debt$debt_mdn <- as.numeric(as.character(uni_w_debt$debt_mdn))
uni_w_debt$grad_debt_mdn <- as.numeric(as.character(uni_w_debt$grad_debt_mdn))
uni_w_debt$wdraw_debt_mdn <- as.numeric(as.character(uni_w_debt$wdraw_debt_mdn))
uni_w_debt$lo_inc_debt_mdn <- as.numeric(as.character(uni_w_debt$lo_inc_debt_mdn))
uni_w_debt$md_inc_debt_mdn <- as.numeric(as.character(uni_w_debt$md_inc_debt_mdn))
uni_w_debt$hi_inc_debt_mdn <- as.numeric(as.character(uni_w_debt$hi_inc_debt_mdn))
uni_w_debt$dep_debt_mdn <- as.numeric(as.character(uni_w_debt$dep_debt_mdn))
uni_w_debt$ind_debt_mdn <- as.numeric(as.character(uni_w_debt$ind_debt_mdn))
uni_w_debt$pell_debt_mdn <- as.numeric(as.character(uni_w_debt$pell_debt_mdn))
uni_w_debt$nopell_debt_mdn <- as.numeric(as.character(uni_w_debt$nopell_debt_mdn))
uni_w_debt$female_debt_mdn <- as.numeric(as.character(uni_w_debt$female_debt_mdn))
uni_w_debt$male_debt_mdn <- as.numeric(as.character(uni_w_debt$male_debt_mdn))
uni_w_debt$firstgen_debt_mdn <- as.numeric(as.character(uni_w_debt$firstgen_debt_mdn))
uni_w_debt$notfirstgen_debt_mdn <- as.numeric(as.character(uni_w_debt$notfirstgen_debt_mdn))

# NAs came up for the Virginia Military Institute. Initially they had "Privacy Suppressed" in two of their cells. Replacing them with zeros. 
uni_w_debt[is.na(uni_w_debt)] = 0

# Creating a column for the median debt amount in 2021
uni_w_debt <- uni_w_debt %>% 
  mutate(overall_median_debt = 22500)
```

# Findings From Their Data & Ours

The main school that had a higher debt than the overall median debt from 2021 across various categories was Grambling State University in Louisiana. The school does not have a policy and they allow sports betting. 

```{r}
#Some Notes: We will analyze this in two ways: one, looking at the overall median and seeing which schools are above that, and what kind of schools they are, and two, picking the schools with the most amount of debt and least amount of debt for each category and see what kind of schools they are as well. Again, we're only looking at legal schools.

# Taking the legal schools
legal_uni_w_debt <- uni_w_debt %>% 
  filter(legal_illegal == "legal")


# Which schools have a higher median principal debt (initial debt upon entering school) than the overall median debt? 
legal_uni_w_debt %>% 
  filter(debt_mdn > overall_median_debt) %>% 
  select(school_uid, school, state, legal_illegal, school_policy_exist, allowed, debt_mdn) %>% 
  view()
## Only one school: Grambling State University. The school is in Louisiana. They don't have a policy and they allow sports betting. Their median debt is $24,727. 

### Percentage for that:
debt_mdn_abv_overall_mdn_debt = (1/64)*100          #1.56% ~ 2%


# Which schools have a higher graduate median debt (students who graduated) than the overall median debt? 
legal_uni_w_debt %>% 
  filter(grad_debt_mdn > overall_median_debt) %>% 
  select(school_uid, school, state, legal_illegal, school_policy_exist, allowed, grad_debt_mdn) %>%
  view()
## 18 schools came up, Grambling being school with the highest graduate median debt ($36,750). Half of the schools have a policy, and the other half don't. 11 schools do not allow sports betting, while seven do. The lowest school that was above the overall median debt was Radford University ($23,249). A school policy doesn't exist for the school, but it the school doesn't allow it. 

### Percentage for that:
grad_debt_mdn_abv_overall_mdn_debt = (18/64)*100    #28.12% ~ 28%


# Which schools have a higher withdrawal median debt (students who didn't complete) than the overall median debt? 
legal_uni_w_debt %>% 
  filter(wdraw_debt_mdn > overall_median_debt) %>% 
  select(school_uid, school, state, legal_illegal, school_policy_exist, allowed, wdraw_debt_mdn) %>%
  view()
## No schools. 


# Which schools have a higher median debt for students who come from lower income households than the overall median debt? 
legal_uni_w_debt %>% 
  filter(lo_inc_debt_mdn > overall_median_debt) %>% 
  select(school_uid, school, state, legal_illegal, school_policy_exist, allowed, lo_inc_debt_mdn) %>%
  view()
## Three schools: Grambling, Western Illinois University and Chicago State University. Grambling had the highest with $25,872 and Chicago had the lowest with $23,534. 

### Percentage for that:
lo_inc_debt_mdn_abv_overall_mdn_debt = (3/64)*100    #4.68% ~ 5%


# Which schools have a higher median debt for students who come from middle income households than the overall median debt? 
legal_uni_w_debt %>% 
  filter(md_inc_debt_mdn > overall_median_debt) %>% 
  select(school_uid, school, state, legal_illegal, school_policy_exist, allowed, md_inc_debt_mdn) %>%
  view()
## No schools. 


# Which schools have a higher median debt for students who come from higher income households than the overall median debt? 
legal_uni_w_debt %>% 
  filter(hi_inc_debt_mdn > overall_median_debt) %>% 
  select(school_uid, school, state, legal_illegal, school_policy_exist, allowed, hi_inc_debt_mdn) %>%
  view()
## No schools. 


# Which schools have a higher median debt for dependent students than the overall median debt? 
legal_uni_w_debt %>% 
  filter(dep_debt_mdn > overall_median_debt) %>% 
  select(school_uid, school, state, legal_illegal, school_policy_exist, allowed, dep_debt_mdn) %>%
  view()
## Grambling, with $23,681. Percentage wise: 1.56% ~ 2%


# Which schools have a higher median debt for independent students than the overall median debt? 
legal_uni_w_debt %>% 
  filter(ind_debt_mdn > overall_median_debt) %>% 
  select(school_uid, school, state, legal_illegal, school_policy_exist, allowed, ind_debt_mdn) %>%
  view()
## Four schools, Grambling, Mississippi Valley State University, Chicago State and Western Illinois. Grambling had the highest of $30,563 and Western Illinois had the lowest of $23,000. 

### Percentage for that:
ind_debt_mdn_abv_overall_mdn_debt = (4/64)*100    #6.25% ~ 6%


# Which schools have a higher median debt for Pell recipient students than the overall median debt? 
legal_uni_w_debt %>% 
  filter(pell_debt_mdn > overall_median_debt) %>% 
  select(school_uid, school, state, legal_illegal, school_policy_exist, allowed, pell_debt_mdn) %>%
  view()
## Three schools, Grambling, Chicago State and Western Illinois. Grambling had the highest of $25,500 and Western Illinois had the lowest of $22,687. Percentage wise: 4.68% ~ 5%


# Which schools have a higher median debt for non-Pell recipient students than the overall median debt?
legal_uni_w_debt %>% 
  filter(nopell_debt_mdn > overall_median_debt) %>% 
  select(school_uid, school, state, legal_illegal, school_policy_exist, allowed, nopell_debt_mdn) %>%
  view()
## None. which is interesting, being that Pell is a scholarship. 


# Which schools have a higher median debt for female students than the overall median debt? 
legal_uni_w_debt %>% 
  filter(female_debt_mdn > overall_median_debt) %>% 
  select(school_uid, school, state, legal_illegal, school_policy_exist, allowed, female_debt_mdn) %>%
  view()
## Two schools, Grambling and Chicago State. Grambling had the highest of $26,000 and Western Illinois had the lowest of $23,041. 

### Percentage for that:
female_debt_mdn_abv_overall_mdn_debt = (2/64)*100    #3.12% ~ 3%


# Which schools have a higher median debt for male students than the overall median debt? 
legal_uni_w_debt %>% 
  filter(male_debt_mdn > overall_median_debt) %>% 
  select(school_uid, school, state, legal_illegal, school_policy_exist, allowed, male_debt_mdn) %>%
  view()
## None. 


# Which schools have a higher median debt for first gen students than the overall median debt? 
legal_uni_w_debt %>% 
  filter(firstgen_debt_mdn > overall_median_debt) %>% 
  select(school_uid, school, state, legal_illegal, school_policy_exist, allowed, firstgen_debt_mdn) %>%
  view()
## One school, Grambling with $24,976. Percentage wise: 1.56% ~ 2%


# Which schools have a higher median debt for nonfirst gen students than the overall median debt? 
legal_uni_w_debt %>% 
  filter(notfirstgen_debt_mdn > overall_median_debt) %>% 
  select(school_uid, school, state, legal_illegal, school_policy_exist, allowed, notfirstgen_debt_mdn) %>%
  view()
## One school, Grambling with $23,857. Percentage wise: 1.56% ~ 2%
```
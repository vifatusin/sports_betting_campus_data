---
title: "gambling_policy_schools_analysis"
author: "Victoria Ifatusin"
date: "11/2/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Some Notes
Some entries still have no schools next to them. Some links still bring me to emails that I don't have access to. Please put in these schools and put in the appropriate link. Some entries don't have any links at all, so please see me regarding that as well.

For the submissions with NA in the link...

Note for Derek W. -- I might need to go over the "unclear" policies, because those submissions have information in them.  

```{r}
# Turn off scientific notation
options(scipen=999)
# Load the tidyverse and other packages.
library(tidyverse)
library(janitor)
library(ggplot2)
library(dplyr)
```

```{r}
# Read in the data.
gambling_policy_tracker <- read_csv("gambling_policy_tracker_updated.csv")

# Cleaning column names
gambling_policy_tracker <- gambling_policy_tracker %>% 
  clean_names() %>% 
  rename(school_policy_exist = does_the_school_have_a_policy_on_sports_gambling_betting_that_extends_beyond_ncaa_policy) %>% 
  rename(allowed = is_sports_gambling_betting_allowed) %>% 
  rename(state_law = does_the_response_cite_state_law) %>% 
  rename(covered = who_is_covered) %>% 
  rename(campus_allowed = is_sports_gambling_allowed_on_or_off_campus) %>% 
  rename(detail = detail_if_there_isnt_any_detail_put_n_a) %>% 
  rename(interesting = rate_the_policys_interestingness_on_a_scale_from_1_5) %>% 
  rename(specifics = give_specific_key_words_or_phrases) %>% 
  rename(advert_policy_exist = does_the_school_have_a_policy_on_the_advertising_or_promotion_of_gambling_or_gaming_products_and_services) %>% 
  rename(detail_advert = briefly_describe_the_advertising_policy_if_theres_no_policy_or_its_unclear_please_put_n_a)

gambling_policy_tracker <- gambling_policy_tracker[-c(33, 34), ]
```

## States that make sport betting illegal

https://www.washingtonpost.com/sports/2022/08/29/sports-betting-laws-by-state/ 

Question: Some states are illegal in person, but allowed online. Are we taking that into consideration?

```{r}
gambling_policy_tracker <- gambling_policy_tracker %>% 
  mutate(legal_illegal = case_when(
    state == 'AL' | state == 'AK' | state == 'CA' | state == 'FL' | state == 'GA' | 
    state == 'HI' | state == 'ID' | state == 'KY' | state == 'MN' | state == 'MO' | 
    state == 'OK' | state == 'SC' | state == 'TX' | state == 'UT' | state == 'VT' ~
    "illegal",
    state == 'AZ' | state == 'AR' | state == 'CO' | state == 'CT' | state == 'DE' | 
    state == 'IL' | state == 'IN' | state == 'IA' | state == 'KS' | state == 'LA' |
    state == 'ME' | state == 'MD' | state == 'MA' | state == 'MI' | state == 'MS' |
    state == 'MT' | state == 'NE' | state == 'NV' | state == 'NH' | state == 'NJ' |
    state == 'NM' | state == 'NY' | state == 'NC' | state == 'ND' | state == 'OH' | 
    state == 'OR' | state == 'PA' | state == 'RI' | state == 'SD' | state == 'TN' |
    state == 'VA' | state == 'WA' | state == 'WV' | state == 'WI' | state == 'WY' ~ 
    "legal"))
```

### Mark's Questions


```{r}
# Pie Chart of schools responded vs, schools not responded: 

schools <- data.frame(
  group = c("responsive_schools", "unresponsive_schools"),
  value = c(69, 162)
  )

pie(schools$value, labels = schools$group)

# Compute the position of labels
schools <- schools %>% 
  arrange(desc(group)) %>%
  mutate(percent = value / sum(schools$value) *100) %>%
  mutate(ypos = cumsum(percent)- 0.5*percent ) %>% 
  mutate(percent = round(schools$percent, digits = 1))

# Basic piechart
ggplot(schools, aes(x="", y=percent, fill=group)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  theme_void() +
  geom_text(aes(y = ypos, label = percent), color = "white", size=6) +
  labs(title = 
  "Out of 231 schools, we have heard back from 69 of them, 
                causing a remainder of 162 schools.") 
```

```{r}
### Schools that are in states where sports betting is legalized. 

gambling_policy_tracker %>% 
  filter(legal_illegal == "legal")

legal_schools <- gambling_policy_tracker %>%
  group_by(legal_illegal) %>% 
  summarise(count = n()) %>% 
  mutate(percentage = (count/69)*100) %>% 
  mutate(percentage = round(legal_schools$percentage, digits = 1)) 

legal_schools %>%   
  ggplot() +
  geom_bar(aes(x=reorder(legal_illegal, count), weight=count), fill = "blue") +
  coord_flip() + 
  geom_text(aes(x=legal_illegal, y=count, label = percentage), hjust=1.5, vjust=0,
            colour = "white") + 
  labs(
    title="No & Percentage of schools in states where sports betting is illegal and legal",
    x = "States",
    y = "Count (#)"
  )

# Out of the 69 schools we've heard from, 42 of them are in states where sports betting is legalized. 



### Schools that are in states where sports betting is allowed, and have a policy on sports betting. 
gambling_policy_tracker %>% 
  filter(legal_illegal == "legal") %>% 
  filter(school_policy_exist == "Yes")

pctg = (16/69)*100

# Out of those 42, only 16 of those schools have a policy on sports betting. The percentage i2 23.2


### Top 5 states where sports betting is legal, and we've heard back from their schools. 
schools_in_legal_states <- gambling_policy_tracker %>% 
  filter(legal_illegal == "legal") %>% 
  group_by(state) %>% 
  summarise(num_states = n()) %>% 
  arrange(desc(num_states)) %>% 
  mutate(pcent = (num_states/69)*100) %>% 
  head(5) %>% 
  mutate(pcent = round(schools_in_legal_states$pcent, digits = 1))

schools_in_legal_states %>% 
  ggplot() +
  geom_bar(aes(x=reorder(state, num_states), weight=num_states), fill = "blue") +
  coord_flip() + 
  geom_text(aes(x=state, y=num_states, label = pcent), hjust=1.5, vjust=0,
            colour = "white") + 
  labs(
    title="Top 5 Percentages of schools in states we've heard back from where 
    sports betting is legal",
    x = "States",
    y = "Count (#)"
  )


### Top 5 states where sports betting is legal and those schools in that state have a policy.
legal_schools_policies <- gambling_policy_tracker %>% 
  filter(legal_illegal == "legal" & school_policy_exist == "Yes") %>% 
  group_by(state) %>% 
  summarise(num_states = n()) %>% 
  arrange(desc(num_states)) %>% 
  mutate(pct = (num_states/69)*100) %>% 
  head(5) %>% 
  mutate(pct = round(legal_schools_policies$pct, digits = 1))

legal_schools_policies %>% 
  ggplot() +
  geom_bar(aes(x=reorder(state, num_states), weight=num_states), fill = "blue") +
  coord_flip() + 
  geom_text(aes(x=state, y=num_states, label = pct), hjust=1.5, vjust=0,
            colour = "white") + 
  labs(
    title="Percentages of the states where sports betting is legal, and schools have a
    policy",
    x = "States",
    y = "Count (#)"
  )
```


## State

As of Nov 1, 2022, ten Virginia schools have gotten back to us regarding whether or not they have a sports betting policy, the highest of the other schools. California comes in with eight, Louisiana comes in with six, and Florida, Ohio, and South Carolina come in with five each. 

I looked into the ten schools from Virginia (which are all done by the homie Derek), and eight of them don't have a policy that extends beyond NCAA policies, but one of the schools have policy on advertising in Virginia, which is Radford. As for the schools that do have a policy beyond NCAA, one interesting school from Virginia (James Madison), makes illegal betting prhibited, but students can bet in their own dorms. 

```{r}
# state responses
gambling_policy_tracker %>% 
  group_by(state) %>% 
  summarise(no_of_policy = n()) %>% 
  arrange(desc(no_of_policy))

# VA had the most, so look into those schools. 
gambling_policy_tracker %>% 
  filter(state == "VA" & school_policy_exist == "No")
gambling_policy_tracker %>% 
  filter(state == "VA" & school_policy_exist == "Yes")

# CA
gambling_policy_tracker %>% 
  filter(state == "CA")

# LA
gambling_policy_tracker %>% 
  filter(state == "LA" & interesting == "4") %>% 
  select(detail) %>% 
  view()

# FL
gambling_policy_tracker %>% 
  filter(state == "FL")

# OH
gambling_policy_tracker %>% 
  filter(state == "OH")

# SC
gambling_policy_tracker %>% 
  filter(state == "SC")

gambling_policy_tracker %>% 
  filter(school_policy_exist == "Yes") %>% 
  group_by(state) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count)) %>% # neither = 33, both = 17, off = 16, on = 2
  ggplot() +
  geom_bar(aes(x=reorder(state,count), weight=count), fill = "blue") +
  coord_flip() + 
  labs(
    title="Where is sports betting mainly allowed?",
    x = "",
    y = "amount"
  ) 
```

## Existence of a school policy that extends beyond NCAA

```{r}
gambling_policy_tracker %>% 
  group_by(school_policy_exist) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count)) %>% # no = 37, yes = 28, unclear = 3
  ggplot() +
  geom_bar(aes(x=reorder(school_policy_exist,count), weight=count), fill = "blue") +
  coord_flip() + 
  labs(
    title="Existence of sports betting policies",
    x = "",
    y = "amount"
  ) 

gambling_policy_tracker %>% 
  filter(school_policy_exist == "No") %>% 
  group_by(state) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))
```

## The number of schools that allow it

```{r}
gambling_policy_tracker %>% 
  group_by(allowed) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count)) %>% # no = 49, yes = 17, unclear = 2
  ggplot() +
  geom_bar(aes(x=reorder(allowed,count), weight=count), fill = "blue") +
  coord_flip() + 
  labs(
    title="Number of schools that allow or don't allow sports betting",
    x = "",
    y = "amount"
  ) 

gambling_policy_tracker %>% 
  filter(allowed == "Yes" & state == "FL") %>% 
  group_by(state) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))
```

## Mention of state law

```{r}
gambling_policy_tracker %>% 
  group_by(state_law) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count)) %>% # no = 44, yes = 24
  ggplot() +
  geom_bar(aes(x=reorder(state_law,count), weight=count), fill = "blue") +
  coord_flip() + 
  labs(
    title="Number of schools that mentioned or didn't mention state law",
    x = "",
    y = "amount"
  ) 

gambling_policy_tracker %>% 
  filter(state_law == "No") %>% 
  group_by(state) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))
```

```{r}
gambling_policy_tracker %>% 
  group_by(covered) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count)) %>% # all = 52, on-campus = 12, athletes = 4
  ggplot() +
  geom_bar(aes(x=reorder(covered,count), weight=count), fill = "blue") +
  coord_flip() + 
  labs(
    title="Type of students that are covered in the policy",
    x = "",
    y = "amount"
  ) 

# the student athletes had to be before the change, reminder that no one should be putting information in the form spreadsheet, only use the form.

gambling_policy_tracker %>% 
  filter(covered == "All") %>% 
  group_by(state) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))
```

## Campus allowed

```{r}
gambling_policy_tracker %>% 
  group_by(campus_allowed) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count)) %>% # neither = 33, both = 17, off = 16, on = 2
  ggplot() +
  geom_bar(aes(x=reorder(campus_allowed,count), weight=count), fill = "blue") +
  coord_flip() + 
  labs(
    title="Where is sports betting mainly allowed?",
    x = "",
    y = "amount"
  ) 

gambling_policy_tracker %>% 
  filter(campus_allowed == "Neither") %>% 
  group_by(state) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))
```

## Existence of an advertising policy 

```{r}
gambling_policy_tracker %>% 
  group_by(advert_policy_exist) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count)) %>% # no = 51, unclear = 13, yes = 4
  ggplot() +
  geom_bar(aes(x=reorder(advert_policy_exist,count), weight=count), fill = "blue") +
  coord_flip() + 
  labs(
    title="The number of schools that have or don't have an advertising policy",
    x = "",
    y = "amount"
  ) 

gambling_policy_tracker %>% 
  filter(advert_policy_exist == "No") %>% 
  group_by(state) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))
```
# Interesting

```{r}
gambling_policy_tracker %>% 
  group_by(interesting) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count)) %>% # 1 = 26, 2 = 20, 3 = 17, 4 = 4, 5 = 1
  ggplot() +
  geom_bar(aes(x=reorder(interesting,count), weight=count), fill = "blue") +
  coord_flip() + 
  labs(
    title="Interestingness scale",
    x = "",
    y = "amount"
  ) 

gambling_policy_tracker %>% 
  filter(interesting == "5") %>% 
  group_by(state) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))

gambling_policy_tracker %>% 
  filter(interesting == "4") %>% 
  group_by(state) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))

gambling_policy_tracker %>% 
  filter(interesting == "3") %>% 
  group_by(state) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))

```

## Result?

Virginia kept coming up when looking at which states have the highest of the highest answer to the questions asked. But it didn't come up when looking at potential interesting states.

